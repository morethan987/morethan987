# 项目说明

使用 JDBC 实现的命令行应用，使用了 RBAC (Role-Based Access Control) 进行权限控制。

## 目录结构说明

仍然采用经典的 MVC 设计模式，分别对应：`controller`, `model`, `view` 文件夹；

在 `model` 文件夹中对实体数据进行了更详细的区分：

1. dao，全称为 data access object，专门负责进行数据库操作；
2. entity 则作为纯粹的数据对象类，封装数据库中的一个数据行；
3. 而 dto，全称为 Data Transfer Object，是为了传递数据而临时封装的一个对象，主要用于构造易于前端显示的数据对象，在进行单表查询的时候并没有太多的必要性，但是在进行合表查询的时候就可以将“数据组合”的逻辑封装到这个类之中，避免在主业务逻辑中引入过多的数据组合操作。

因此最终的数据流就是：

```text
DB -> DAO -> DTO -> View
```

## 一些思考

1. 在数据库设计的时候常常会遇到“多对多”的关系，在数据库表设计的时候一般会创建一个桥接表，用于实现这个多对多的关系。但是在 DAO 层是否需要创建一个真实的“桥接类”呢？

答案：一般是不用的，这个桥接表只会作为 SQL 参数在特定的类成员方法中出现，比如 StudentDAO 类中会有一个“选课”操作，而这个方法就会去操作桥接表，不用专门的类去操作；那么什么时候需要创建一个类来管理呢？一般是选课这个操作本身还有一些别的字段需要存储，比如选课时间等等，这样选课就会独立为一个实体

2. RBAC 简单来说就是：不对用户分配具体的权限，而是为其分配角色，角色再绑定具体权限。但是在实际操作过程中就需要斟酌一下了：假如一个用户是学生，那么该学生的密码等等信息是存放在Student表中还是Role表中？

答案：这个问题本质上是将权限管理中的角色和实际业务逻辑中的具体数据行混淆了。也就是说，在这个系统中涉及到两个“学行”，其中“学生”角色只是用于进行权限控制，既然是鉴权，那么密码就该放在这里；而“学生”实体类则用于表示一条学生的数据，比如，姓名学号性别等等。并且一般为了保证设计的完整性，一般会将用户与角色设计成多对多的关系。

3. 通过 RBAC 我们将使用系统的用户具体地划分为了多个不同的角色，那么在具体代码实现中如何利用角色信息来控制权限？难不成每一个业务函数执行之前都要写一堆的条件判断？这也太💩了吧？

答案：确实，这么做很💩，所以实际上并没有那么做，一般会使用权限码来对权限进行抽象，从而能够统一管理。具体流程就是：在具体的函数中定义一个字段用来标记这个函数需要什么权限，比如“修改学生成绩”需要“MODIFY_GRADE”这个操作码代表的权限；然后在定制角色的时候会为不同的角色分配不同的权限码；由于根据操作码进行权限鉴别的逻辑非常统一，于是抽象一个Auth类来管理权限验证的具体逻辑；最终，控制器在调用具体的函数之前会先调用Auth类进行鉴权。

4. 如果使用权限码来实现 RBAC，那么可以想象，将会产生一大堆的权限码，并且这些权限码分散在不同的函数之中，在设计角色的时候将会非常麻烦：需要查看每一个函数到底使用了什么权限码，然后进行分配。这不对吧？

答案：确实不对，实际的代码开发过程中一般会根据具体的系统功能来定义操作码（在定义系统功能的时候使用注解注册操作码），然后在编写具体函数的时候会通过注解的形式标记这个函数的权限。并且一般只对顶层函数进行标记，比如“导出学生数据表”这个操作不同于简单地“查看学生数据”，但都依赖于“查询学生数据”这个更底层的方法，因此不应该对底层执行函数进行权限标记。

另外：也不能把权限码的来源简单理解为对数据对象的增删改查操作权限，就像上面说的例子：“导出学生数据表”这个操作不同于“查看学生数据”，虽然二者底层都是对学生数据进行查询。更加典型的例子就是一些数据库设计网站：你可以在网页上进行数据库设计，显然你能够看到这些你设计的数据库，但是如果你想“导出”的话，就需要充会员了😅

5. 既然权限码是从系功能中抽取出来的，那么权限码的注册应该放到View层？

答案：权限码的注册应该在系统控制器中，也就是说，使用注解的时候同时完成了两件事情：标记这个系统函数需要什么权限码，标记了这个系统功能对角色提供什么可选的权限；前一个功能用于系统的权限控制，后一个功能用于角色权限重定义（比如管理员可以修改其他角色的访问权限，甚至新增一个角色，注解用于提供所有注册的权限码，避免手动翻找权限码）

这个权限码注册的注解功能确实是非常普遍，但是目前市面上的注解只实现了一半的功能：进行系统权限控制；至于角色权限重定义一般都是大公司手写
