spring.application.name=GradeSystemBackend
# 服务端口号
server.port=8081

# 应用上下文路径 (比如所有接口都想以 /api/v1 开头)
server.servlet.context-path=/api/v1

# HTTP 请求头大小限制 (防止过大的 Header 攻击或截断)
server.max-http-header-size=20KB

# ----------------------------------------------------
# 1. 数据库连接配置 (PostgreSQL)
# ----------------------------------------------------
# JDBC URL for PostgreSQL
spring.datasource.url=jdbc:postgresql://localhost:5432/grade_sys
spring.datasource.username=morethan
spring.datasource.password=mo123456789
spring.datasource.driver-class-name=org.postgresql.Driver
# 连接池允许的最大连接数 (生产环境建议根据并发量调整，例如 10-20)
spring.datasource.hikari.maximum-pool-size=20

# 连接池中维护的最小空闲连接数
spring.datasource.hikari.minimum-idle=5

# 连接超时时间 (毫秒)，如果在这个时间内拿不到连接会抛出异常
spring.datasource.hikari.connection-timeout=30000

# 连接在池中的最大生存时间 (防止数据库侧连接超时断开)
spring.datasource.hikari.max-lifetime=1800000

# 连接空闲超时时间 (10分钟)
spring.datasource.hikari.idle-timeout=600000

# 连接池中连接的最大空闲时间检查频率
spring.datasource.hikari.keepalive-time=300000

# 启用连接泄漏检测 (开发环境)
spring.datasource.hikari.leak-detection-threshold=60000

# 连接测试查询
spring.datasource.hikari.connection-test-query=SELECT 1

# ----------------------------------------------------
# 2. JPA & Hibernate 配置
# ----------------------------------------------------
# schema
spring.jpa.properties.hibernate.default_schema=grade_system

# DDL 模式:
# update: Hibernate 会根据实体自动更新数据库表结构（开发常用）
# create: 每次启动都会删除并重建表
# none: 不做任何操作（生产环境常用）
spring.jpa.hibernate.ddl-auto=create

# 显示 Hibernate 生成的 SQL (方便调试)
spring.jpa.show-sql=false

# 1. 格式化 SQL: 让控制台输出的 SQL 换行缩进，更易读
spring.jpa.properties.hibernate.format_sql=true

# 2. 命名策略: 自动将 Java 的驼峰命名 (userName) 映射为数据库的下划线命名 (user_name)
# Spring Boot 默认其实已经开启了，但显式指定更保险
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy

# 3. Open-in-View 模式 (非常重要!)
# 默认是 true。开启时，数据库 Session 会绑定到整个 HTTP 请求周期。
# 优点：可以在 Controller/View 层懒加载 (Lazy Load) 属性。
# 缺点：性能较差，容易导致数据库连接被长时间占用。
# 建议：项目中通常建议设置为 false，强制在 Service 层处理完所有数据。
spring.jpa.open-in-view=false

# 4. 事务和并发控制配置
# 默认事务隔离级别 (READ_COMMITTED 适合大多数场景)
spring.jpa.properties.hibernate.connection.isolation=2

# 启用二级缓存 (可选，谨慎使用)
spring.jpa.properties.hibernate.cache.use_second_level_cache=false

# 批处理大小配置
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# 连接池统计和监控
spring.jpa.properties.hibernate.generate_statistics=false

# 乐观锁异常处理
spring.jpa.properties.hibernate.jdbc.use_get_generated_keys=true

# ----------------------------------------------------
# 3. JSON  处理
# ----------------------------------------------------
# 1. 日期格式化: 设定全局的时间格式 (例如 2023-10-01 12:00:00)
spring.jackson.date-format=yyyy-MM-dd HH:mm:ss

# 2. 时区设置: 极其重要！如果不设置，默认是 UTC，中国时间会少8小时
spring.jackson.time-zone=GMT+8

# ----------------------------------------------------
# 4. 日志配置
# ----------------------------------------------------
# 全局日志级别 (info, debug, warn, error)
logging.level.root=info

# 单独设置你的包的日志级别 (方便调试自己的代码)
logging.level.com.yourpackage.gradesystem=info

# 日志文件输出路径 (生产环境必须配置，否则日志只在控制台，关机就没了)
logging.file.name=logs/grade-system.log
logging.file.max-size=10MB

# ----------------------------------------------------
# 5. 并发控制和性能优化配置
# ----------------------------------------------------
# 线程池配置
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
server.tomcat.max-connections=8192
server.tomcat.accept-count=100

# 连接超时配置
server.tomcat.connection-timeout=20000
server.tomcat.keep-alive-timeout=20000

# 启用压缩
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain,application/javascript,text/css

# Spring 事务配置
spring.transaction.default-timeout=30
spring.transaction.rollback-on-commit-failure=true

# 数据库查询超时
spring.jpa.properties.jakarta.persistence.query.timeout=30000

# 启用 SQL 查询缓存（谨慎使用）
spring.jpa.properties.hibernate.cache.use_query_cache=false

# JVM 优化建议（在启动脚本中设置）
# -Xms512m -Xmx2g
# -XX:+UseG1GC
# -XX:MaxGCPauseMillis=200
