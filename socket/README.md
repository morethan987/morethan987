# Python 聊天室工具

一个基于 Python Socket 的简单命令行聊天室工具，支持群聊和私聊功能，可通过手机热点进行跨设备连接。

## 功能特性

- ✅ **用户昵称系统**: 每个用户可设置个性化昵称
- ✅ **群聊模式**: 所有在线用户可见的公共聊天
- ✅ **私聊模式**: 一对一私密聊天功能
- ✅ **跨设备连接**: 支持通过手机热点连接不同设备
- ✅ **在线用户列表**: 实时查看所有在线用户
- ✅ **友好的命令行界面**: 简单易用的交互方式
- ✅ **类QQ界面布局**: 新增curses版本，消息左右对齐显示

## 文件结构

```
socket/
├── server.py          # 聊天服务器
├── client.py          # 聊天客户端 (简单版本)
├── client_ui.py       # 聊天客户端 (改进UI版本)
└── README.md          # 使用说明
```

## 使用方法

### 1. 启动服务器

```bash
python server.py
```

服务器启动后会显示：
- 监听端口 (默认: 8888)
- 本机IP地址
- 连接提示信息

```
[*] 聊天服务器启动
[*] 监听端口: 8888
[*] 本机IP: 192.168.1.100
[*] 手机热点用户请连接IP: 192.168.1.100
[*] 等待用户连接...
```

### 2. 启动客户端

有两个客户端版本可选：

#### 简单版本 (client.py)
基础的命令行界面：

**本地连接:**
```bash
python client.py
```

**局域网/手机热点连接:**
```bash
python client.py <服务器IP地址>
```

#### 改进UI版本 (client_ui.py) - 推荐
类似QQ的界面布局，消息左右对齐显示，用户列表分离：

**本地连接:**
```bash
python client_ui.py
```

**局域网/手机热点连接:**
```bash
python client_ui.py <服务器IP地址>
```

例如：
```bash
python client_ui.py 192.168.1.100
```

### 3. 设置昵称

启动客户端后，系统会提示输入昵称：
```
请输入您的昵称: 张三
```

## 聊天命令

### 群聊消息
直接输入消息内容并发送：
```
> 大家好！
```

### 私聊消息
使用 `@昵称` 格式发送私聊消息：
```
> @李四 你好！
```

### 系统命令

#### 简单版本 (client.py)
| 命令 | 功能 | 示例 |
|------|------|------|
| `/help` 或 `/h` | 显示帮助信息 | `/help` |
| `/users` 或 `/u` | 查看在线用户列表 | `/users` |
| `/quit` 或 `/q` 或 `exit` | 退出聊天室 | `/quit` |
| `Ctrl+C` | 强制退出程序 | `Ctrl+C` |

#### 改进UI版本 (client_ui.py)
| 操作 | 功能 | 说明 |
|------|------|------|
| `Enter` | 发送消息 | 在底部输入框输入消息后按回车发送 |
| `/quit` | 退出聊天室 | 在输入框中输入/quit |
| `PageUp/PageDown` | 滚动消息 | 向上/向下滚动查看历史消息 |
| `Ctrl+C` | 强制退出程序 | 强制退出 |
| `Backspace/Delete` | 编辑消息 | 在输入框中编辑文本 |
| `←/→方向键` | 移动光标 | 在输入框中移动文本光标 |

## 网络连接配置

### 手机热点连接方式

1. **打开手机热点**: 在手机设置中开启个人热点
2. **连接设备**: 将其他设备连接到该手机热点
3. **获取服务器IP**: 运行 `server.py` 会显示本机IP地址
4. **客户端连接**: 使用该IP地址连接服务器

### 局域网连接

1. 确保所有设备在同一局域网内
2. 运行服务器获取IP地址
3. 客户端使用该IP连接

## 界面展示

### 改进UI版本界面 (client_ui.py)
```
┌─────────────── 聊天室 - 张三 ───────────────┐
│[10:30:15] 系统: 欢迎加入聊天室！              │ 在线用户 (3)  │
│                                             │ ──────────── │
│[10:30:20] 李四: 大家好！                    │  张三         │
│                   [10:30:25] 我: 你好！     │  李四         │
│[10:30:30] [私聊] 王五: 私聊消息             │  王五         │
│          [10:30:35] 我 -> 王五: 回复消息     │              │
│                                             │              │
│                                             │              │
│─────────────────────────────────────────────┤──────────────│
│输入消息 (Enter发送, Ctrl+C退出):             │              │
│ 正在输入的消息...                           │              │
│快捷键: @用户名 私聊 | PageUp/PageDown 滚动消息│              │
└─────────────────────────────────────────────┴──────────────┘
```

### 简单版本消息格式 (client.py)
**群聊消息:**
```
张三: 大家好！
```

**私聊消息:**
```
[私聊] 李四: 你好！
```

**系统消息:**
```
欢迎 张三 加入聊天室！
张三 离开了聊天室
```

**在线用户列表:**
```
===== 在线用户 =====
1. 张三
2. 李四
3. 王五
====================
```

## 错误处理

### 常见错误及解决方法

1. **连接服务器失败**
   - 检查服务器是否启动
   - 确认IP地址和端口号正确
   - 检查网络连接

2. **私聊发送失败**
   - 确认目标用户在线
   - 检查昵称拼写是否正确
   - 使用 `/users` 查看在线用户

3. **昵称设置失败**
   - 昵称不能为空
   - 昵称长度不超过20个字符

## 技术实现

### 核心技术
- **Python Socket**: 基于TCP协议的网络通信
- **多线程**: 支持多用户同时在线
- **JSON数据格式**: 结构化消息传输
- **Unicode支持**: 完美支持中文消息

### 消息协议

客户端发送消息格式 (JSON):
```json
{
    "type": "group|private|get_users",
    "message": "消息内容",
    "target": "目标用户昵称(私聊时使用)"
}
```

服务器响应消息格式 (JSON):
```json
{
    "type": "group|private|user_list|error",
    "sender": "发送者昵称",
    "message": "消息内容",
    "users": ["用户1", "用户2"]  // user_list类型时使用
}
```

## 系统要求

### 基本要求
- Python 3.6+
- 网络连接 (局域网或手机热点)

### 系统支持
- **client.py**: Windows, macOS, Linux
- **client_ui.py**: Windows, macOS, Linux (需要终端支持curses)

## 安全注意事项

1. **网络安全**: 建议在可信网络环境中使用
2. **数据加密**: 当前版本未实现消息加密
3. **访问控制**: 建议设置强密码保护热点
4. **端口安全**: 确保防火墙允许8888端口通信

## 扩展功能建议

- [ ] 消息加密功能
- [ ] 用户认证系统
- [ ] 文件传输功能
- [ ] 聊天记录保存
- [ ] 图形用户界面
- [ ] 语音聊天功能

## 故障排除

### 端口被占用
如果8888端口被占用，可以修改代码中的端口号：

```python
# server.py 和 client.py 中
port = 8889  # 修改为其他端口
```

### 防火墙问题
确保防火墙允许Python程序的网络通信和8888端口的访问。

### IP地址获取问题
服务器会自动检测并显示可用的IP地址，如果检测不准确，可以手动配置。

## 更新日志

### v3.0 (当前版本)
- ✅ 新增改进UI版本 (client_ui.py)
- ✅ 类QQ界面布局，消息左右对齐
- ✅ 实时用户列表显示
- ✅ 消息滚动查看功能
- ✅ 更好的输入体验
- ✅ 时间戳显示
- ✅ 不同消息类型颜色区分

### v2.0 
- ✅ 添加用户昵称系统
- ✅ 实现群聊和私聊功能
- ✅ 支持手机热点连接
- ✅ 添加在线用户列表
- ✅ 完善错误处理机制
- ✅ 改进用户界面体验

### v1.0 (原始版本)
- ✅ 基本的群聊功能
- ✅ 多用户支持

## 许可证

本项目仅供学习和研究使用。